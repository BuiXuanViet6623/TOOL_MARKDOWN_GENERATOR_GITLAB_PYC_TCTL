import os
import re
import datetime
import random
import traceback
from flask import Flask, request, jsonify, send_file
from flask_cors import CORS
import zipfile
import io

app = Flask(__name__)
CORS(app)

FIXED_APPS = [
    "91视频", "台湾Swag", "Porn高清", "Pornbest", "Pornhub", "tiktok成人版",
    "50度灰", "黄瓜视频", "香蕉视频", "樱桃视频", "蜜桃视频", "幸福宝",
    "中国X站", "果冻传媒", "麻豆传媒", "天美传媒", "精东传媒", "大象传媒",
]

FIXED_URLS = [
    "最新在线地址", "入口地址发布页", "当前可用地址", "永久地址", "官方最新地址",
    "在线观看入口", "免费观看入口", "不用付费观看", "无广告在线播放", "高清视频免费看",
]

TEMPLATES = [
# ----------------------- Template 1 -----------------------
"""# {title}

🎉 欢迎来到 {app}{url} 官方导航页！

尊敬的用户您好！本页面由 {app} 官方维护，专门为需要稳定访问渠道的用户提供最及时、最可靠的最新地址信息与实用指导。我们理解在不同网络环境、不同地区访问同一服务时可能遇到的各种限制与干扰，因此将多条经常更新与检测的备用通道集中在此，以便您在遇到主站不可达、延迟升高或访问异常时能够第一时间切换并恢复正常使用体验。本导航同时提供详细的使用建议、故障排查步骤与隐私安全说明，帮助您以最小的成本、最快的速度解决访问问题。

关键词：{keywords_text}  
📅 更新时间：{date}

🔗 当前可用访问入口（建议全部收藏为备用）：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

📌 平台说明与核心优势：
- **全天候链接监测**：我们部署了分布在不同地区的监控节点，实时检查各入口的连通性、响应时延与错误率。一旦检测到单点故障或响应延迟异常，系统会自动标注并触发人工复核与替换，力求让您在第一时间得到可用的访问路径，从根源上减少“打不开”的情况。
- **多节点加速与智能路由**：为提升全球用户访问速度，我们采用多节点 CDN 与智能路由策略。系统会根据您的地理位置与当前网络状况智能匹配最优节点，尽可能降低跨境传输延迟并提升页面打开速度与流媒体加载流畅度。
- **严格的安全与隐私策略**：本导航不要求用户注册，亦不会保存可识别个人信息；所有通讯均通过 HTTPS 加密通道传输，防止中间人攻击与数据泄露；后台仅以匿名统计数据用于链路健康监控，不会进行用户行为追踪或数据售卖。
- **简洁无广告的使用体验**：导航页与官方入口承诺纯净无广告，不植入第三方弹窗脚本或跟踪代码，保障用户在打开页面时能快速获取到可用链接而不受骚扰。

⚙️ 访问前准备与常规操作建议：
- **收藏并同时保存多个入口**：建议把主站与两个备用链接同时加入书签或笔记中，以便主链接出现问题时能快速切换，避免浪费时间查找新地址。
- **优先尝试隐身/无痕模式**：临时访问问题往往由浏览器缓存或插件造成，隐身模式可避免历史数据与扩展干扰，快速判断是否为本地环境问题。
- **更换浏览器或更新至最新版**：主流浏览器（Chrome、Firefox、Edge、Safari）对现代网页协议与视频解码支持更好，更新能带来更稳定的兼容性与更安全的环境。
- **网络环境切换检查**：当 Wi-Fi 访问缓慢或屏蔽严重时，尝试切换至移动数据（4G/5G）或其他网络环境进行测试，确认是否为运营商或路由器层面的问题。
- **高质量 VPN/代理作为补充方案**：在确实存在地区限制与线路屏蔽时，使用信誉良好的 VPN（建议付费、具备多节点与混淆特性）能最大程度提高访问成功率与播放稳定性。

🔍 常见访问问题诊断与解决方案（详尽流程）：
1. **页面无法打开或 404/超时**：先刷新页面（F5 / ⌘R），若无效则清理浏览器缓存或尝试隐身模式；仍然无法打开时，立即切换至备用入口进行访问；若备用入口也不可用，请稍等数分钟以便后台完成自动替换或手动修复。
2. **视频播放卡顿或频繁中断**：优先检查本地带宽是否饱和，关闭其他占用网络的应用；切换至最近的加速节点或备用入口，多数情况下可明显改善播放流畅性。若仍卡顿，尝试降低播放清晰度以减轻带宽压力。
3. **频繁被运营商或地域策略屏蔽**：建议选择具备混淆传输与多节点切换的商业 VPN，避免使用免费或来源不明的代理工具；同时尽量在安全网络环境（如家庭宽带）下进行访问，减少公共 Wi-Fi 导致的中断风险。
4. **页面异常弹窗或跳转**：若出现陌生弹窗或强制跳转，请立即停止操作并清理浏览器插件、扩展，检查是否误点了非官方链接。官方入口承诺不含强制弹窗与广告，遇到异常请通过官方渠道反馈以便核查。

🛡 隐私与安全须知（用户须读）：
- 本导航为您提供可访问入口，不要求任何用户上传个人资料或进行注册；所有链接均通过加密通道传输。
- 建议不要在不受信任的公共电脑上保存书签或密码，避免个人信息泄漏。
- 使用任何第三方工具（如 VPN、代理）时，请优先选择口碑良好、信誉可靠的付费服务商，以免带来额外风险。

✨ 建议收藏与后续关注：
我们强烈建议您将本页标记为书签，并在每次访问前先打开本页确认最新入口，以减少因域名更换或临时屏蔽而导致的访问中断。如需进一步帮助，请通过本站提供的官方联系方式进行反馈，技术团队将尽快处理并回复。

祝您访问顺畅、体验愉快 —— 感谢您选择并信任 {app}。""",

# ----------------------- Template 2 -----------------------
"""# {title}

🔥 {app} - {url} 官方最新地址集合与使用指南

欢迎来到本官方导航页。本文旨在为所有希望稳定访问 {app} 的用户提供一份详尽且实际可操作的参考手册：包含即时可用入口、优化访问的具体步骤、常见问题的深入分析与快速修复办法。无论您是初次访问还是长期使用的用户，都能在此找到对您最有价值的信息与实用建议，帮助您以最小的时间成本恢复访问并提升使用体验。

关键词：{keywords_text}  
📅 页面更新日期：{date}

🔗 立即可用入口（建议收藏）：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

📌 为什么我们要提供此导航与多条备用入口？
- **应对域名轮换与屏蔽**：在某些网络环境下，域名可能会被临时屏蔽或限制，多个备用入口可以显著提高可达性，避免单点失效导致的长期中断。
- **提高用户体验的稳定性**：通过智能路由与多节点分发，用户能自动匹配到响应最快的节点，从而缩短页面和内容加载时间，减少卡顿。
- **降低单点风险**：集中维护多个入口可以分散风险，当某一节点受限时，系统能快速切换到其他节点，保障整体服务的连续性。

🌟 平台核心优势（详述）：
- **全天候链路健康监控**：我们部署了自动化与人工复核相结合的检测体系，覆盖连通性、响应时间、丢包率等关键指标，从而对异常情况进行快速定位与处理。
- **严格入口审核机制**：每一条对外公布的入口都需通过安全扫描、行为审查与稳定性测试，保证不会引入恶意脚本或隐藏风险，维护用户安全。
- **多层次缓存与加速**：通过边缘缓存与智能调度，提升资源加载效率，缓解高峰时段的瞬时压力，确保播放与浏览体验的连贯性。
- **隐私保护与合规性**：不保存用户可识别信息，统计数据仅用于链路优化，遵守相关数据保护法规。

🔧 深度访问优化步骤（逐步展开）：
1. **确认入口来源**：优先从本导航页面复制入口，避免点击非官方渠道或来历不明的短链。
2. **初步排查**：若页面无法打开，先确认本地网络是否正常（尝试访问其它网站），再测试不同浏览器或设备，以排除本地环境问题。
3. **缓存与插件排查**：使用隐身模式或临时禁用插件，排查是否为扩展导致的冲突。
4. **切换入口与网络**：如👉👉主站入口👈👈不可用，立即切换备用入口；若仍然不可达，尝试更换网络（如移动数据）或使用信誉良好的 VPN。
5. **提交反馈**：在确认问题并收集关键诊断信息（如时间戳、错误截图、使用的入口）后，通过官方反馈渠道提交，以便技术团队做进一步排查。

❓ 常见问题详解（场景化说明）：
- **打不开但其它网站正常**：可能为 DNS 污染或链路被 ISP 限制，先切换 DNS（例如 8.8.8.8 / 1.1.1.1）或更换网络，再尝试备用入口。
- **播放时频繁缓冲**：确认本地带宽是否被占用，尝试关闭后台占带应用并选择靠近的节点或降低播放清晰度。
- **出现不明跳转或广告**：立即停止交互并返回本导航页面核对链接来源，避免误点未授权的第三方页面。

🔒 安全提示与用户须知：
- 切勿在陌生设备或公共终端上保存登录凭证或书签；尽量在可信设备上访问并保存链接。
- 选择信誉良好的 VPN 提升在受限区域的访问成功率，同时注意保护个人隐私信息。
- 任何涉及收费或要求提供个人信息的页面都可能为钓鱼风险，请提高警惕并及时向我们反馈。

结语：我们不断优化技术与服务流程，致力于为用户提供可持续、可靠的访问体验。请务必收藏本页面，以便在需要时快速获取最新地址与支持信息。""",

# ----------------------- Template 3 -----------------------
"""# {title}

🚀 {app} 官方跳转入口与使用说明 - {url}

欢迎访问本官方导航页面。我们深知，稳定的入口和清晰的操作指引同样重要——前者保障您能打开所需页面，后者则帮助您在遇到异常时迅速恢复访问。为此，本页不仅提供立即可用的三条入口，还在每一部分都提供了详细的步骤、建议与排查流程，力求把复杂问题简单化、把可能的中断变成可控的过程。

关键词：{keywords_text}  
📅 更新时间：{date}

🔗 可用访问入口：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

📌 核心设计理念：
- **以用户体验为中心**：我们优先选择加载速度快、稳定性强的节点，并对入口进行分级管理，以便在出现异常时按优先级自动切换。
- **可复用的应急方案**：凡是可能导致访问失败的因素（例如 DNS 污染、区域封锁、运营商限速等），我们都为用户准备了多种可操作的替代方案，用户可按步骤逐一排查。
- **最小化侵入与高关注隐私**：导航页不会嵌入追踪脚本或第三方广告模块，所有数据统计均采取匿名化处理，严守用户隐私边界。

🔧 详细排查指南（步骤化）：
1. **确认网络通畅性**：先在设备上测试若干常用网站，若其它网站可访问，问题多半出在入口或中间链路；反之，则优先处理本地网络问题。
2. **尝试备用入口**：复制本页的备用链接在新标签页打开，若能访问则说明主链路受限，切换至备用入口可继续使用。
3. **检测本地 DNS**：若怀疑 DNS 污染，可尝试将 DNS 改为公共 DNS（如 8.8.8.8/1.1.1.1）后再次访问。
4. **使用隐身模式与禁用插件**：扩展或插件有时候会注入脚本或阻断特定请求，隐身模式能暂时规避这类干扰。
5. **必要时联系支持**：收集好访问日志、错误页面截屏并标注具体时间，提交至官方支持以便我们更快定位问题。

🔒 关于安全：
- 所有官方入口均启动 HTTPS，确保数据传输加密；若访问过程中出现非 HTTPS 的跳转，请提高警惕并停止操作。
- 官方入口不会要求用户输入多余的个人信息，若遇到要求填写账号密码或银行卡信息的页面，请勿轻易提交，并及时向我们反馈。

✨ 小结：
本导航页旨在为您提供最直接、最可靠的访问途径，并在您遇到访问难题时提供可执行的解决方案。请务必收藏本页，并在每次访问前优先核对入口是否为本页公布的最新地址。""",

# ----------------------- Template 4 -----------------------
"""# {title}

🌟 {app} 永久导航页与稳定性保障 - {url}

尊敬的用户，感谢您使用 {app}。随着互联网环境不断演进，域名迁移或暂时性屏蔽时有发生。为了减少对您使用的影响，我们建立了本永久导航页，并持续维护多条备用访问通道，保证在多种不利网络条件下仍能保持较高的可用性与访问成功率。

关键词：{keywords_text}  
📅 最后更新：{date}

🔗 推荐访问链接（建议收藏）：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

📌 长期可用性的技术措施：
- **定期健康检查与链路排序**：系统会定期运行全量健康检测，并根据响应时延、成功率对入口进行排序，优先将流量导向表现最佳的节点。
- **多级容灾与自动切换**：在主节点出现异常时，自动进行容灾切换，减少人工干预时间，尽量保证业务连续性。
- **版本与协议兼容性检测**：针对浏览器与客户端版本差异，我们持续进行兼容性测试并针对性优化入口表现。

💡 用户操作建议（确保长期稳定访问）：
- 建议您同时在多个设备上备份入口信息，以便一端出现问题时能够用其他设备临时继续访问。
- 定期检查并更新所使用的浏览器与操作系统，防止因版本过旧导致的兼容或安全问题。
- 若您常在受限网络环境中访问，考虑使用商业 VPN 或企业级网络加速服务以提升成功率。
- 对于企业用户或有高可用性需求的用户，我们提供定制化的接入方案，请联系商务或技术支持获取更多信息。

🔒 隐私与合规：
- 我们承诺导航页数据采集仅限于保障服务质量的匿名化统计，不会用于用户画像或商业化出售。
- 如需删除或询问匿名统计的数据使用情况，请通过官方渠道提交请求，我们将按合规流程处理。

结语：请将本页标记为收藏夹，遇到访问问题时优先参考本页提供的入口与排查步骤。如需帮助，我们欢迎您的反馈与建议，技术团队将尽快协助解决。""",

# ----------------------- Template 5 -----------------------
"""# {title}

📘 {app} 访问全指南与常见场景解决方案 - {url}

欢迎使用本访问指南。无论您是初次尝试还是长期用户，本篇都将通过可操作的步骤与详尽的说明，帮助您在面对不同网络问题时快速定位并解决问题。我们将入口、优化技巧、常见错误与修复办法一并呈现，力求让每位用户都能以最短时间恢复访问并获得良好体验。

关键词：{keywords_text}  
📅 更新时间：{date}

🔗 立即可用入口（请收藏）：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

📌 场景化问题与解决方案详述：
- **场景一：本地网络不稳定但其他网站正常**  
  说明：当出现仅访问本平台异常的情况时，常见原因包括 DNS 污染、链路被 ISP 干预或某些中间路由出现问题。  
  解决：先切换至备用入口测试；若依然异常，尝试切换 DNS（如 8.8.8.8/1.1.1.1），或更换网络（4G/5G）来判断是否为运营商限制；同时收集访问时间与错误信息提交给我们以便排查。
- **场景二：页面可打开但资源加载缓慢或丢失**  
  说明：通常为 CDN 节点缓存不同步或边缘节点负载高所致。  
  解决：刷新页面并尝试清理缓存；短期内切换至备用入口或等待系统同步更新；如为长时间问题我们会优先处理对应节点。
- **场景三：出现非官方跳转或异常弹窗**  
  说明：可能是误点到第三方链接或浏览器插件注入脚本。  
  解决：立即关闭该页面，进入隐身模式或无扩展模式重新从本导航复制并打开官方入口；必要时检查浏览器扩展并移除可疑插件。

🔧 综合优化建议：
- 使用隐身模式可排除很多由插件和缓存引发的问题。
- 在出现问题时记录发生时间、使用的入口与错误页面截图，有助于我们快速定位与处理。
- 经常关注本导航页的更新，以获取第一手的可用入口与公告。

🔒 关于隐私与安全：
- 我们不会收集个人资料，所有统计以匿名方式进行，旨在提升访问稳定性。
- 请谨慎对待任何要求提供个人敏感信息的页面，官方不会通过入口发送此类请求。

结尾：感谢您使用 {app}，若希望获得企业级或更高可用性保障，请联系官方商务/技术支持，我们可提供定制化方案与 SLA 服务。""",

# ----------------------- Template 6 -----------------------
"""# {title}

🌐 {app} 多线路保障与全球访问优化 - {url}

尊敬的用户，欢迎访问本页面。本指南旨在帮助全球用户在多种网络环境下都能稳定访问 {app}。我们针对跨国访问所面临的高延迟、丢包与链路不稳问题，提供了可操作的优化方法与稳妥的备用方案，确保您能够以较低的失败概率打开所需内容并维持较好体验。

关键词：{keywords_text}  
📅 更新时间：{date}

🔗 可用访问入口：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

📌 深入技术说明与用户可感知的优势：
- **智能节点选择**：系统会基于地理位置、实时链路质量与节点负载自动分配最优访问路径，从而在跨境访问时显著降低延迟并提升连接稳定性。
- **边缘缓存优化**：对于常见静态资源与首屏内容，边缘节点提前缓存可减少原始服务器压力，提高页面首屏加载速度，改善用户首要印象。
- **容灾策略与回退机制**：当主节点因不可预见事件失效时，系统会自动启动预置的回退机制，保证仍有可用节点供用户切换访问。
- **加密与完整性保护**：全链路 TLS 加密结合校验机制，确保数据在传输过程中不被篡改或劫持，维护访问安全性。

⚙️ 推荐的操作流程（遇到问题时逐步执行）：
1. 立即切换备用链接测试能否恢复访问。  
2. 如果备用链接也不可用，尝试切换网络（如移动数据）。  
3. 使用隐身模式或禁用浏览器扩展以排查插件干扰。  
4. 修改本地 DNS 为公共 DNS（8.8.8.8/1.1.1.1）并重试访问。  
5. 收集错误信息并通过官方反馈通道提交，便于我们优化对应节点或链路。

🔍 常见问题深度解析：
- **DNS 污染导致的解析错误**：通过更换 DNS 或使用加密 DNS（DoH/DoT）可有效降低此类问题的发生率。
- **运营商限速或封锁**：在极端网络限制环境中，商业 VPN 或企业级加速器是更稳妥的解决方案。
- **节点负载高导致的卡顿**：临时切换节点或等待系统自动分流为可行方法，若为持续性问题我们将对节点进行扩容或优化。

🔒 隐私与合规提示：
- 我们不会保存与传播任何个人敏感信息，统计数据以脱敏形式用于提升平台可靠性。
- 如需在企业环境中部署，请联系我们获取专属接入方案与合规支持。

✨ 结语：为保证最佳使用体验，请务必收藏本导航页，并按本文建议逐步排查与切换入口。如需进一步协助，我们的技术团队随时待命。""",

# ----------------------- Template 7 -----------------------
"""# {title}

📢 {app} 官方强烈推荐的访问方案与操作手册 - {url}

欢迎来到本官方操作手册。本页面不仅集中展示最新可用的三个入口，还将以用户为中心，逐项说明在不同环境和故障类型下的最优处理策略，让您在面对访问困难时能够快速而从容地恢复连接。

关键词：{keywords_text}  
📅 最后更新时间：{date}

🔗 推荐入口（请收藏）：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

📌 我们为什么要这样设计入口体系？
- **确保不间断访问**：通过多入口与多节点分发，任何单点问题都不会导致用户大面积无法访问。
- **简化用户操作**：我们把复杂的链路切换与节点管理隐藏在后台，用户只需在遇到问题时按照简单步骤切换即可。
- **提升响应速度**：智能分配机制会优先选取延迟最低的节点，提升页面打开与资源加载速度。

🛠 详细的排查与恢复步骤（逐条展开）：
1. **初步检查**：确认本地网络与设备是否正常，尝试打开常用网站以判断是本地还是目标链路问题。  
2. **无痕模式测试**：在隐身窗口中打开备用入口，判断是否受插件或缓存影响。  
3. **DNS 与网络切换**：尝试使用公共 DNS 并切换网络（如从 Wi-Fi 切换到 4G/5G）。  
4. **VPN 试验**：如果前述方法都无法恢复，尝试使用信誉良好的 VPN 节点进行连接测试。  
5. **提交诊断信息**：将错误信息（时间、入口、错误截屏）提交给官方支持，加速问题定位与处理。

💡 用户最佳实践：
- 将本导航与备用入口保存在安全的位置（如密码管理器的备注或受保护的文档中）。  
- 定期访问本导航以获取最新入口与公告。  
- 对于对可用性要求极高的用户，建议配置多条备用通道与企业级接入方案。  

🔒 隐私与安全说明：
- 导航本身不采集敏感数据，所有数据处理遵循隐私优先原则。  
- 推荐用户使用可信赖的工具与服务，避免使用来路不明的免费代理。  

感谢您使用 {app}，我们将持续改进并保持对用户渠道的稳定维护。""",

# ----------------------- Template 8 -----------------------
"""# {title}

🔗 {app} 访问优化与故障诊断全指南 - {url}

您好！若您在访问 {app} 时遭遇任何阻碍，本指南将提供从基础到进阶的全流程解决办法。我们把常见问题按优先级排序，给出可立即执行的操作指令，帮助您以最快速度恢复访问并提升后续访问稳定性。

关键词：{keywords_text}  
📅 更新时间：{date}

🔗 当前可用链接：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

📌 快速恢复步骤（优先顺序）：
1. **刷新与清理**：刷新页面并清除浏览器缓存，以排除本地缓存与重定向残留问题。  
2. **隐身模式**：在隐身/无痕窗口中打开备用入口，排除扩展干扰。  
3. **切换网络**：从 Wi-Fi 切换至移动数据或其他网络以判断是否为本地 ISP 限制。  
4. **DNS调整**：更换为公共 DNS（如 8.8.8.8 / 1.1.1.1），或使用加密 DNS（DoH/DoT）以避免 DNS 污染。  
5. **使用高质量 VPN**：在区域限制较严格时，VPN 可作为可靠的补救手段。

⚙️ 深度诊断建议（适用于技术用户）：
- 使用 `ping` / `traceroute` 工具检测到达主站或备用节点的跳点情况，定位是否在某一跃点出现丢包或延迟异常。  
- 检查浏览器控制台与网络日志，分析请求是否被重定向或拦截。  
- 若发现异常路由或被劫持的流量路径，请将相关截图与日志提交至我们以便进一步调查。

🔒 安全建议：
- 避免使用来源不明的代理软件或免费 VPN，以免造成数据泄露风险。  
- 在公共网络中避免提交敏感信息，使用可信设备与网络进行重要操作。

结语：本指南覆盖了从普通用户到技术用户的不同层次需求，按照步骤执行可大幅提高问题定位与解决效率。如需人工协助，请将诊断信息提交给我们，技术团队会尽快跟进。""",

# ----------------------- Template 9 -----------------------
"""# {title}

🛠️ {app} 常见问题解答与实战排查手册 - {url}

欢迎来到官方的常见问题与排查手册页面。为了让您在遇到访问问题时能够从容面对，我们把经常出现的故障类型进行归类，并给出详细的解决流程与注意事项，帮助您在最短时间内恢复访问。

关键词：{keywords_text}  
📅 更新时间：{date}

🔗 官方可用入口（请优先从本页复制使用）：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

❓ 汇总常见问题（情景 + 原因 + 解决方案）：
- **无法解析域名或 DNS 错误**：原因可能为本地 DNS 缓存或运营商污染；解决：更换 DNS（8.8.8.8/1.1.1.1）、清理本地 DNS 缓存或使用加密 DNS。
- **页面加载但资源不能显示**：多为 CDN 节点缓存不同步或边缘节点故障；解决：尝试备用入口或等待系统完成缓存同步；若严重请反馈节点信息。
- **视频播放卡顿/频繁缓冲**：通常因带宽或节点负载；解决：关闭占用带宽程序、切换至更近节点、降低播放清晰度。
- **被重定向到非官方页面或弹窗**：可能由不安全的第三方脚本或劫持插件引起；解决：停止访问、在隐身模式中复核、禁用可疑扩展。

🔧 逐步诊断模板（便于复制到支持工单）：
1. 复现问题并记录时间点；  
2. 记录使用的入口 URL 与浏览器版本；  
3. 截取控制台报错或网络请求日志；  
4. 发送上述信息给官方支持团队以便快速定位。

🔒 隐私与使用提醒：
- 本指南仅用于提高访问成功率，请勿使用违规手段绕过合法的访问限制。  
- 对于需要更高保障的企业用户，我们提供定制化接入与支持服务，欢迎联系商务团队洽谈。

谢谢您使用 {app}，我们会持续优化入口的稳定性并提供及时的技术支持。""",

# ----------------------- Template 10 -----------------------
"""# {title}

🌈 {app} 高可用访问合集与用户保障 - {url}

本页面汇集了 {app} 的最新官方入口与全面的用户保障建议，旨在为您提供一站式的访问支持。无论是首次尝试还是长期使用，本合集都包含了从入口链接、常见问题、优化建议到隐私说明等全套参考内容，方便您在任何场景下高效完成访问。

关键词：{keywords_text}  
📅 更新日期：{date}

🔗 官方入口（请收藏）：
- [👉👉主站入口👈👈]({domain})
- [👉👉备用链接一👈👈]({domain})
- [👉👉备用链接二👈👈]({domain})

📌 我们的服务承诺：
- **可靠性承诺**：通过多节点备份与自动化切换机制，尽可能保证入口的持续可用性。  
- **安全承诺**：所有入口均通过安全审查，使用 HTTPS 加密传输，保障访问过程中的信息安全。  
- **隐私承诺**：不收集用户可识别信息，统计数据用于提升可靠性与性能。

💡 使用与应急建议汇总：
- 收藏并保存多个入口，以便在出现临时封锁或维护时可无缝切换。  
- 当遇到问题时，先按顺序尝试：刷新页面 → 隐身模式 → 备用入口 → 切换网络 → 使用 VPN → 联系支持。  
- 若需向技术支持提交问题，请附上访问时间、入口 URL、错误截图与所用设备/浏览器信息，有助于我们快速定位与修复。

📞 技术支持与反馈：
我们欢迎并重视每一位用户的反馈。请通过本页提供的官方反馈渠道提交问题，技术团队会在最短时间内响应并协助处理。您的反馈也是我们优化与扩展服务的重要依据。

感谢您使用 {app}，祝您访问顺利、体验愉快！"""
]

OUTPUT_FOLDER = "generated_markdown_files"
os.makedirs(OUTPUT_FOLDER, exist_ok=True)

def log_error(msg):
    with open("error.log", "a", encoding="utf-8") as f:
        f.write(msg + "\n")

def sanitize_filename(text):
    return re.sub(r'[\\/*?:"<>|]', "_", text)

def generate_md_content(app, url, keyword_list, suffix):
    title = f"{app}-{url}-{'-'.join(keyword_list)}-{suffix}"
    date_now = datetime.datetime.now().strftime("%Y-%m-%d")
    keywords_text = "，".join(keyword_list)
    subdomain = ''.join(random.choices('abcdefghijklmnopqrstuvwxyz0123456789', k=3))
    domain_link = f"https://{subdomain}.zaixianyule.top/"

    template = random.choice(TEMPLATES)
    content = template.format(
        title=title,
        app=app,
        url=url,
        keywords_text=keywords_text,
        suffix=suffix,
        date=date_now,
        domain=domain_link
    )
    return content

@app.route("/ping", methods=["GET"])
def ping():
    return jsonify({"msg": "pong"})

@app.route("/", methods=["GET"])
def root_home():
    return jsonify({"msg": "Welcome to the Flask API. Use /ping to test or /generate to create markdown files."}), 200

@app.route("/generate", methods=["POST"])
def generate_markdown_files():
    try:
        data = request.get_json()
        if not data:
            return jsonify({"error": "Missing JSON body"}), 400

        keywords = data.get("keywords")
        cy = data.get("cy")

        if not keywords or not isinstance(keywords, list) or not all(isinstance(k, str) for k in keywords):
            return jsonify({"error": "Invalid or missing 'keywords' list"}), 400
        if not cy or not isinstance(cy, str):
            return jsonify({"error": "Invalid or missing 'cy' string"}), 400

        today_str = datetime.datetime.now().strftime("%m%d")
        suffix = f"{today_str}{cy}|881比鸭"

        used_filenames = set()
        created_files = []

        app_fixed = random.choice(FIXED_APPS)
        url_fixed = random.choice(FIXED_URLS)

        # Lấy toàn bộ từ khóa, tạo 1 bài cho mỗi từ khóa
        selected_keywords = keywords

        memory_zip = io.BytesIO()
        with zipfile.ZipFile(memory_zip, mode="w", compression=zipfile.ZIP_DEFLATED) as zf:
            for keyword in selected_keywords:
                safe_keyword = sanitize_filename(keyword)
                filename = f"{safe_keyword}.md"

                # Tránh trùng tên file
                original_filename = filename
                count = 1
                while filename in used_filenames:
                    filename = f"{safe_keyword}_{count}.md"
                    count += 1
                used_filenames.add(filename)

                other_keywords = random.sample(keywords, min(2, len(keywords)))
                if keyword not in other_keywords:
                    keyword_list = [keyword] + other_keywords
                else:
                    keyword_list = other_keywords

                content = generate_md_content(app_fixed, url_fixed, keyword_list, suffix)
                zf.writestr(filename, content)
                created_files.append(filename)

        memory_zip.seek(0)
        zip_filename = f"Tool-MARKDOWN-TCTL-PYC-{datetime.datetime.now().strftime('%Y-%m-%d')}.zip"

        return send_file(
            memory_zip,
            as_attachment=True,
            download_name=zip_filename,
            mimetype="application/zip"
        )

    except Exception as e:
        err = f"Error: {e}\n{traceback.format_exc()}"
        log_error(err)
        return jsonify({"error": "Internal server error", "details": str(e)}), 500


if __name__ == "__main__":
    port = int(os.environ.get("PORT", 5000))
    print(f"🚀 Server running on port {port}")
    app.run(host="0.0.0.0", port=port, debug=False)


